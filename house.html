
<html>
<body>

<script src="gl-matrix.js"></script>
<script src="../build/he.js"></script>
<script src="../build/element.js"></script>
<script src="../build/add-html.js"></script>
<script src="../build/function-call.js"></script>
<script src="../build/make-it-editable.js"></script>
<script src="draw-scene.js"></script>


<script id="fill-shader" type="x-shader/x-fragment">
    precision mediump float;

    varying vec4 vColor;

    void main(void) {
        gl_FragColor = vColor;
    }
</script>

<script id="geometry-shader" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec4 aVertexColor;

    uniform mat4 uniformMoveMatrix;
    uniform mat4 uniformCameraMatrix;

    varying vec4 vColor;

    void main(void) {
        gl_Position = uniformCameraMatrix * uniformMoveMatrix * vec4(aVertexPosition, 1.0);
        vColor = aVertexColor;
    }
</script>

<canvas style="border: none;" width="300" height="300"></canvas>

</body>

<script>







// Our world

var shapes = [
  {
    position: [-1.5, 0.0, -7.0],
    verticies: [
       0.0,  1.0,  0.0,
      -1.0, -1.0,  0.0,
       1.0, -1.0,  0.0
    ],
    pointCount: 3,
    colors: [
      1.0, 0.4, 0.6, 1.0,
      0.9, 0.4, 0.7, 1.0,
      0.8, 0.4, 0.9, 1.0
    ]
  },
  {
    position: [3.0, 0.0, 0.0],
    verticies: [
       1.0,  1.0,  0.0,
      -1.0,  1.0,  0.0,
       1.0, -1.0,  0.0,
      -1.0, -1.0,  0.0
    ],
    pointCount: 4,
    colors: [
      1.0, 0.8, 0.2, 1.0,
      0.9, 0.7, 0.4 , 1.0,
      0.8, 0.7, 0.6, 1.0,
      0.7, 0.6, 0.8, 1.0
    ]
  }
]

function getShapeData(shapeId, key, i) {
  return shapes[shapeId][key][i]
}

function setShapeData(shapeId, key, i, value) {
  shapes[shapeId][key][i] = value
  drawScene(shapes)
}







// Data

var button = element.template.container(
  ".button",
  element.style({
    "font-family": "sans-serif",
    "padding": "8px 12px 10px 12px",
    "display": "inline-block",
    "font-size": "11pt"
  })
)

var valueTemplate = element.template(
  button,
  ".value",
  element.style({
    "background": "pink",
    "margin-right": "10px"
  }),
  function(value, shapeId, key, i) {
    this.children = [element.raw(""+value)]

    makeItEditable(
      this,
      functionCall(getShapeData).withArgs(shapeId, key, i),
      functionCall(setShapeData).withArgs(shapeId, key, i)
    )
  }
)

var shapeTemplate = element.template(
  ".shape-code",
  element.style({
    "background": "#fafafa",
    "margin-bottom": "10px",
    "max-width": "300px"
  }),
  function(shape, id) {

    this.children = [
      inputs(id, "position", shape.position),
      inputs(id, "verticies", shape.verticies),
      inputs(id, "colors", shape.colors),
      inputs(id, "pointCount", [shape.pointCount])
    ]

  }
)

var inputs = element.template(
  ".inputs",
  element.style({
    "margin-bottom": "10px" 
  }),
  function inputs(shapeId, key, values) {
    this.children.push(button(key))

    for(var i=0; i<values.length; i++) {
      valueElement = valueTemplate(values[i], shapeId, key, i)

      this.children.push(valueElement)
    }
  }
)


function drawCode(shapes) {
  addHtml(
    element.stylesheet(
      valueTemplate,
      shapeTemplate,
      button,
      inputs
    ).html()
  )

  for(var i=0; i<shapes.length; i++) {
    var shape = shapes[i]
    var el = shapeTemplate(shape, i)
    addHtml(el.html())
  }

}




makeItEditable.onBottomOfScreen()

drawScene(shapes)

drawCode(shapes)


</script>

</html>